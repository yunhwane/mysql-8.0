## 공통 코드의 단점
- 공통 코드를 도입하면 관리가 편해지지만, 복잡성과 성능 관련을 고민이 생긴다.

### 문제 1
- SQL 이 복잡해진다.
- 튜닝 관점에서 서브쿼리 사용해서 조인을 없애더라도 걍 코드의 성능 단점이 명확하다

- 공통 코드 없이 단순 조회했을때
```sql
SELECT
  o.order_id,
  m.name AS member_name,
  o.order_status,
  o.total_amount
FROM orders o
JOIN members m ON o.member_id = m.member_id
ORDER BY o.order_id;
```
- 여기서 order_status 에 'ORDER', 'PAID' 같은 code 값이 표시된다.
- response 에서는 '주문접수', '결제완료' 같은 한글이름을 표시해야한다. 코드 이름을 찾기 위해서 공통 코드를 조인해보자.
### 주문 정보 조회 시
```sql
SELECT
  o.order_id,
  m.name AS member_name,
  o.order_status,
  os.name AS order_status_name,
  o.total_amount
FROM orders o
JOIN members m
  ON o.member_id = m.member_id
JOIN common_code_detail os
  ON os.group_code = 'ORDER_STATUS' AND o.order_status = os.code
ORDER BY o.order_id;
```

### 또한 만약에 회원 등급까지 조인해야한다면?
```sql
SELECT
  o.order_id,
  m.name AS member_name,
  m.grade,
  mg.name AS grade_name,
  o.order_status,
  os.name AS order_status_name,
  o.total_amount
FROM orders o
JOIN members m
  ON o.member_id = m.member_id
JOIN common_code_detail os
  ON os.group_code = 'ORDER_STATUS' AND o.order_status = os.code
JOIN common_code_detail mg
  ON mg.group_code = 'MEMBER_GRADE' AND m.grade = mg.code
ORDER BY o.order_id;
```

### 여기서 결제 정보까지 모두 조인이 되어야한다면?
```sql
-- 결제 정보까지 모두 조인
SELECT
  o.order_id,
  m.name AS member_name,
  m.grade,
  mg.name AS grade_name,
  o.order_status,
  os.name AS order_status_name,
  o.total_amount,
  p.payment_method,
  pm.name AS payment_method_name,
  p.payment_status,
  ps.name AS payment_status_name,
  p.amount AS payment_amount
FROM orders o
JOIN members m ON o.member_id = m.member_id
JOIN payments p ON o.order_id = p.order_id
JOIN common_code_detail os
  ON os.group_code = 'ORDER_STATUS' AND o.order_status = os.code
JOIN common_code_detail mg
  ON mg.group_code = 'MEMBER_GRADE' AND m.grade = mg.code
JOIN common_code_detail pm
  ON pm.group_code = 'PAYMENT_METHOD' AND p.payment_method = pm.code
JOIN common_code_detail ps
  ON ps.group_code = 'PAYMENT_STATUS' AND p.payment_status = ps.code
ORDER BY o.order_id;
```

## 코드 이름 조회 중복
- 관리자용 주문 목록 조회
```sql
SELECT
  o.order_id,
  m.name AS member_name,
  o.order_status,
  os.name AS order_status_name, -- 중복!
  o.total_amount
FROM orders o
JOIN members m ON o.member_id = m.member_id
JOIN common_code_detail os
  ON os.group_code = 'ORDER_STATUS' AND o.order_status = os.code
ORDER BY o.created_at DESC;
```
- 사용자 마이페이지용 주문 목록 조회
```sql
SELECT
  o.order_id,
  o.order_status,
  os.name AS order_status_name, -- 중복!
  o.total_amount
FROM orders o
JOIN common_code_detail os
  ON os.group_code = 'ORDER_STATUS' AND o.order_status = os.code
WHERE o.member_id = 1
ORDER BY o.created_at DESC;
```
- 배송중인 주문 목록 조회
```sql
SELECT
  o.order_id,
  m.name AS member_name,
  o.order_status,
  os.name AS order_status_name, -- 중복!
  o.total_amount
FROM orders o
JOIN members m ON o.member_id = m.member_id
JOIN common_code_detail os
  ON os.group_code = 'ORDER_STATUS' AND o.order_status = os.code
WHERE o.order_status = 'SHIPPING';
```
> 나중에 code 값이 변경된다면, 모든 쿼리를 변경해야한다.




